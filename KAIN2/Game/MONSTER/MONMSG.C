#include "Game/CORE.H"
#include "MONMSG.H"
#include "Game/STATE.H"

int MON_GroundMoveQueueHandler(struct _Instance* instance)  // Matching - 100%
{
	struct _MonsterVars* mv;
	struct __Event* message;
	int ret;

	ret = 0;
	mv = (struct _MonsterVars*)instance->extraData;
	while (TRUE)
	{
		message = DeMessageQueue(&mv->messageQueue);
		if (message == NULL) break;
		if (message->ID == 0x4010080)
		{
			ret = 0x4010080;
		}
		else
		{
			MON_IdleMessageHandler(instance, message);
		}
	}
	return ret;
}


// autogenerated function stub: 
// void /*$ra*/ MON_PupateMessageHandler(struct _Instance *instance /*$s2*/, struct __Event *message /*$a1*/)
void MON_PupateMessageHandler(struct _Instance *instance, struct __Event *message)
{ // line 60, offset 0x80084840
	/* begin block 1 */
		// Start line: 61
		// Start offset: 0x80084840
		// Variables:
			struct _MonsterVars *mv; // $s0
			long id; // $v1

		/* begin block 1.1 */
			// Start line: 72
			// Start offset: 0x800848F4
			// Variables:
				struct evMonsterAlarmData *data; // $s1
		/* end block 1.1 */
		// End offset: 0x8008497C
		// End Line: 79

		/* begin block 1.2 */
			// Start line: 86
			// Start offset: 0x800849BC
			// Variables:
				//struct evFXHitData data; // stack offset -40
		/* end block 1.2 */
		// End offset: 0x800849FC
		// End Line: 93
	/* end block 1 */
	// End offset: 0x80084A6C
	// End Line: 165

	/* begin block 2 */
		// Start line: 128
	/* end block 2 */
	// End Line: 129
				UNIMPLEMENTED();
}

void MON_PossessedMessageHandler(struct _Instance* instance, struct __Event* message)
{ // line 75, offset 0x8007c0b0
	/* begin block 1 */
		// Start line: 76
		// Start offset: 0x8007C0B0
		// Variables:
	struct _MonsterVars* mv; // $s0
	long id; // $s1
	int state; // $s2

/* begin block 1.1 */
	// Start line: 125
	// Start offset: 0x8007C228
	// Variables:
	short target; // $a1
	int nochange; // $s5

/* begin block 1.1.1 */
	// Start line: 132
	// Start offset: 0x8007C23C
	// Variables:
	short speed; // $a2
/* end block 1.1.1 */
// End offset: 0x8007C364
// End Line: 148
/* end block 1.1 */
// End offset: 0x8007C3AC
// End Line: 162
/* end block 1 */
// End offset: 0x8007C3AC
// End Line: 169

/* begin block 2 */
	// Start line: 161
/* end block 2 */
// End Line: 162
	UNIMPLEMENTED();
}

void MON_IdleMessageHandler(struct _Instance* instance, struct __Event* message) // Matching - 100%
{
	struct _MonsterVars* mv;
	long id;
	char temp;  // not from SYMDUMP

	temp = 0;

	id = message->ID;

	mv = (struct _MonsterVars*)instance->extraData;

	switch (id)
	{
	case 0x1000002:
	case 0x100000A:
	case 0x1000023:
		if (message != NULL)  // garbage code for reodering 
		{
			temp = -temp;
		}

		if (message->Data == 0)
		{
			MON_SwitchState(instance, MONSTER_STATE_PARRY);
		}

		MON_DefaultMessageHandler(instance, message);
		break;
	case 0x100000E:
		if (!(mv->mvFlags & 0x4))
		{
			struct _MonsterIR* mir;

			mir = (struct _MonsterIR*)message->Data;

			if ((INSTANCE_Query(mir->instance, 1) & 0x1))
			{
				MON_ChangeBehavior(instance, mv->triggeredBehavior);
			}

			MON_SwitchState(instance, MONSTER_STATE_SURPRISED);
		}

		break;
	case 0x1000012:
		if (!(mv->mvFlags & 0x4))
		{
			struct _MonsterIR* mir;

			mir = (struct _MonsterIR*)message->Data;

			if ((INSTANCE_Query(mir->instance, 1) & 0x1))
			{
				MON_ChangeBehavior(instance, mv->triggeredBehavior);
			}

			MON_SwitchState(instance, MONSTER_STATE_NOTICE);
		}

		break;
	default:
		MON_DefaultMessageHandler(instance, message);
	}
}


// autogenerated function stub: 
// void /*$ra*/ MON_DefaultMessageHandler(struct _Instance *instance /*$s2*/, struct __Event *message /*$s3*/)
void MON_DefaultMessageHandler(struct _Instance *instance, struct __Event *message)
{ // line 220, offset 0x80084bc8
	/* begin block 1 */
		// Start line: 221
		// Start offset: 0x80084BC8
		// Variables:
			struct _MonsterAttributes *ma; // $a1
			struct _MonsterVars *mv; // $s1
			long id; // $a0

		/* begin block 1.1 */
			// Start line: 232
			// Start offset: 0x80084E94
			// Variables:
				struct evMonsterHitData *data; // $s5
				int fatal; // $s4
				int damage; // $s0

			/* begin block 1.1.1 */
				// Start line: 296
				// Start offset: 0x80084EEC
				// Variables:
					struct _MonsterCombatAttributes *combat; // $s0
			/* end block 1.1.1 */
			// End offset: 0x80084EEC
			// End Line: 296
		/* end block 1.1 */
		// End offset: 0x80084F7C
		// End Line: 329

		/* begin block 1.2 */
			// Start line: 333
			// Start offset: 0x80084FA4
			// Variables:
				int state; // $a1
				//struct evMonsterHitData *data; // $s0
		/* end block 1.2 */
		// End offset: 0x80085048
		// End Line: 372

		/* begin block 1.3 */
			// Start line: 395
			// Start offset: 0x800850A4
			// Variables:
				//struct evMonsterSoulSuckData *data; // $v0
		/* end block 1.3 */
		// End offset: 0x800850DC
		// End Line: 399

		/* begin block 1.4 */
			// Start line: 437
			// Start offset: 0x800851C8
			// Variables:
				int vuln; // $s0
		/* end block 1.4 */
		// End offset: 0x800852A4
		// End Line: 471

		/* begin block 1.5 */
			// Start line: 486
			// Start offset: 0x800852FC
		/* end block 1.5 */
		// End offset: 0x80085360
		// End Line: 490

		/* begin block 1.6 */
			// Start line: 530
			// Start offset: 0x800853F8
			// Variables:
				//struct evMonsterAlarmData *data; // $s0
				struct _Instance *enemy; // $s3

			/* begin block 1.6.1 */
				// Start line: 537
				// Start offset: 0x8008543C

				/* begin block 1.6.1.1 */
					// Start line: 542
					// Start offset: 0x80085488
					// Variables:
						struct _MonsterIR *mir; // $v0
				/* end block 1.6.1.1 */
				// End offset: 0x800854A0
				// End Line: 547
			/* end block 1.6.1 */
			// End offset: 0x800854A0
			// End Line: 548
		/* end block 1.6 */
		// End offset: 0x800854A0
		// End Line: 552

		/* begin block 1.7 */
			// Start line: 558
			// Start offset: 0x800854BC
			// Variables:
				//struct _MonsterIR *mir; // $v0
		/* end block 1.7 */
		// End offset: 0x800854DC
		// End Line: 560

		/* begin block 1.8 */
			// Start line: 566
			// Start offset: 0x80085508
			// Variables:
				int hp; // $v1
		/* end block 1.8 */
		// End offset: 0x80085524
		// End Line: 569

		/* begin block 1.9 */
			// Start line: 602
			// Start offset: 0x800855B8
			// Variables:
				//struct evFXHitData data; // stack offset -80
		/* end block 1.9 */
		// End offset: 0x800855F8
		// End Line: 609

		/* begin block 1.10 */
			// Start line: 668
			// Start offset: 0x80085720
			// Variables:
			//	struct evFXHitData data; // stack offset -56
		/* end block 1.10 */
		// End offset: 0x80085720
		// End Line: 669

		/* begin block 1.11 */
			// Start line: 683
			// Start offset: 0x800857B0
		/* end block 1.11 */
		// End offset: 0x800857B0
		// End Line: 686

		/* begin block 1.12 */
			// Start line: 701
			// Start offset: 0x80085810
			// Variables:
				struct evPositionData *posData; // $a0
		/* end block 1.12 */
		// End offset: 0x80085810
		// End Line: 701

		/* begin block 1.13 */
			// Start line: 709
			// Start offset: 0x80085830
			// Variables:
				//struct evPositionData *posData; // $v1
		/* end block 1.13 */
		// End offset: 0x80085830
		// End Line: 709

		/* begin block 1.14 */
			// Start line: 719
			// Start offset: 0x80085870
			// Variables:
				//struct evPositionData *posData; // $v1
		/* end block 1.14 */
		// End offset: 0x80085870
		// End Line: 719

		/* begin block 1.15 */
			// Start line: 732
			// Start offset: 0x800858BC
			// Variables:
				static int deaths[9]; // offset 0x0
		/* end block 1.15 */
		// End offset: 0x800858BC
		// End Line: 743

		/* begin block 1.16 */
			// Start line: 749
			// Start offset: 0x800858E8
			// Variables:
				//struct evMonsterHitData *data; // $s0
		/* end block 1.16 */
		// End offset: 0x800858E8
		// End Line: 749

		/* begin block 1.17 */
			// Start line: 756
			// Start offset: 0x80085924
			// Variables:
				int i; // $s1
				//struct evActionPlayHostAnimationData *data; // $s0
		/* end block 1.17 */
		// End offset: 0x8008597C
		// End Line: 760

		/* begin block 1.18 */
			// Start line: 764
			// Start offset: 0x80085984
			// Variables:
				//struct evAnimationInstanceSwitchData *data; // $v0
		/* end block 1.18 */
		// End offset: 0x8008599C
		// End Line: 766
	/* end block 1 */
	// End offset: 0x8008599C
	// End Line: 771

	/* begin block 2 */
		// Start line: 459
	/* end block 2 */
	// End Line: 460
				UNIMPLEMENTED();
}

void MON_PupateQueueHandler(struct _Instance* instance)  // Matching - 100%
{
	struct _MonsterVars* mv;
	struct __Event* message;

	mv = (struct _MonsterVars*)instance->extraData;

	while (message = DeMessageQueue(&mv->messageQueue))
	{
		MON_PupateMessageHandler(instance, message);
	}
}

void MON_IdleQueueHandler(struct _Instance *instance)  // Matching - 100%
{
	struct _MonsterVars* mv;
	struct __Event* message;

	mv = (struct _MonsterVars*)instance->extraData;

	while (message = DeMessageQueue(&mv->messageQueue))
	{
		MON_IdleMessageHandler(instance, message);
	}
}

void MON_DefaultQueueHandler(struct _Instance* instance)  // Matching - 100%
{
	struct _MonsterVars* mv;
	struct __Event* message;

	mv = (struct _MonsterVars*)instance->extraData;

	while (message = DeMessageQueue(&mv->messageQueue))
	{
		MON_DefaultMessageHandler(instance, message);
	}
}