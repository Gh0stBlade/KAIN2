#include "CORE.H"
#include "PHYSOBS.H"
#include "Game/STATE.H"
#include "Game/FX.H"
#include "G2/ANMCTRLR.H"
#include "MEMPACK.H"
#include "PSX/COLLIDES.H"
#include "G2/QUATG2.H"
#include "MATH3D.H"

// autogenerated function stub: 
// void /*$ra*/ PHYSOB_PlayDropSound(struct _Instance *instance /*$a0*/)
void PHYSOB_PlayDropSound(struct _Instance *instance)
{ // line 208, offset 0x80068700
	/* begin block 1 */
		// Start line: 209
		// Start offset: 0x80068700
		// Variables:
			struct PhysObProperties *Prop; // $a1
			int sound; // $v1
	/* end block 1 */
	// End offset: 0x8006880C
	// End Line: 247

	/* begin block 2 */
		// Start line: 416
	/* end block 2 */
	// End Line: 417
			UNIMPLEMENTED();
}


// autogenerated function stub: 
// struct _Instance * /*$ra*/ PHYSOBS_IsAPushBlockAttached(struct _Instance *block /*$s3*/)
struct _Instance * PHYSOBS_IsAPushBlockAttached(struct _Instance *block)
{ // line 259, offset 0x80068820
	UNIMPLEMENTED();
	return NULL;
}

struct _Instance* PHYSOBS_IsAnythingAttached(struct _Instance* block) // Matching - 100%
{
	struct _Instance* instance;
	struct _Instance* next;
	struct _Instance* result;

	instance = gameTrackerX.instanceList->first;
	result = NULL;

	while (instance != NULL)
	{
		next = instance->next;

		if (instance->attachedID == block->introUniqueID)
		{
			result = instance;
			break;
		}

		instance = next;
	}

	return result;
}

int CheckPhysOb(struct _Instance* instance) // Matching - 100%
{
	struct PhysObProperties* Prop;

	Prop = (struct PhysObProperties*)instance->data;

	if (Prop != NULL)
	{
		return (Prop->ID ^ 0xB00B) < 1;
	}

	return 0;
}

int CheckPhysObAbility(struct _Instance* instance, unsigned short ability) // Matching - 100%
{
	struct PhysObProperties* prop;

	prop = (struct PhysObProperties*)instance->data;
	if (prop != NULL)
	{
		if (prop->ID != 0xB00B)
		{
			return 0;
		}
		else if (prop->family == 3)
		{
			if (((struct PhysObData*)instance->extraData)->xForce & (ability & 0xFFFF))
			{
				return 1;
			}
		}
		else if (prop->Type & ability)
		{
			return 1;
		}
	}
	return 0;
}

int CheckPhysObFamily(struct _Instance* instance, unsigned short family) // Matching - 100%
{
	struct PhysObProperties* Prop;

	Prop = (struct PhysObProperties*)instance->data;

	if (Prop != NULL)
	{
		if (Prop->ID != 0xB00B)
		{
			return 0;
		}
	
		if (Prop->family == family)
		{
			return 1;
		}
	}
	
	return 0;
}


// ***************** does not exist on pc
// autogenerated function stub: 
// int /*$ra*/ GetPhysicalAbility(struct _Instance *instance /*$a0*/)
int GetPhysicalAbility(struct _Instance *instance)
{ // line 402, offset 0x800689dc
	/* begin block 1 */
		// Start line: 404
		// Start offset: 0x800689DC
		// Variables:
			struct PhysObProperties *Prop; // $a1

		/* begin block 1.1 */
			// Start line: 413
			// Start offset: 0x80068A0C
		/* end block 1.1 */
		// End offset: 0x80068A20
		// End Line: 416
	/* end block 1 */
	// End offset: 0x80068A2C
	// End Line: 422

	/* begin block 2 */
		// Start line: 818
	/* end block 2 */
	// End Line: 819

	/* begin block 3 */
		// Start line: 819
	/* end block 3 */
	// End Line: 820

	/* begin block 4 */
		// Start line: 823
	/* end block 4 */
	// End Line: 824
			UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ AnyBlocksInMotion()
int AnyBlocksInMotion()
{ // line 426, offset 0x80068a34
	UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// void /*$ra*/ SetThrowDirection(struct _Instance *instance /*$s1*/, struct _Instance *parent /*$a1*/, struct evObjectThrowData *throwData /*$s2*/, struct PhysObData *Data /*$a3*/)
void SetThrowDirection(struct _Instance* instance, struct _Instance* parent, struct evObjectThrowData* throwData, struct PhysObData* Data)
{ // line 456, offset 0x80068ad4
	UNIMPLEMENTED();
}

// ************** not on pc
// autogenerated function stub: 
// void /*$ra*/ ThrowPhysOb(struct _Instance *instance /*$s3*/, struct evObjectThrowData *throwData /*$s0*/)
void ThrowPhysOb(struct _Instance *instance, struct evObjectThrowData *throwData)
{ // line 564, offset 0x80068e20
	/* begin block 1 */
		// Start line: 565
		// Start offset: 0x80068E20
		// Variables:
			struct PhysObData *Data; // $s2
			int collFlg; // $s4
			int endAnimFlg; // $s6

		/* begin block 1.1 */
			// Start line: 574
			// Start offset: 0x80068E5C
			// Variables:
				struct _Instance *parent; // $s5
				struct PhysObProperties *Prop; // $s1

			/* begin block 1.1.1 */
				// Start line: 611
				// Start offset: 0x80068F4C
				// Variables:
					struct _SVector *sv; // $v1
			/* end block 1.1.1 */
			// End offset: 0x80068F78
			// End Line: 617

			/* begin block 1.1.2 */
				// Start line: 630
				// Start offset: 0x80068FA8
				// Variables:
					struct __PhysObProjectileData *ProjData; // $s0

				/* begin block 1.1.2.1 */
					// Start line: 647
					// Start offset: 0x8006901C
				/* end block 1.1.2.1 */
				// End offset: 0x8006903C
				// End Line: 650
			/* end block 1.1.2 */
			// End offset: 0x80069044
			// End Line: 654

			/* begin block 1.1.3 */
				// Start line: 672
				// Start offset: 0x80069090
				// Variables:
					//struct _PCollideInfo pcollideInfo; // stack offset -96
					_Position newPos; // stack offset -48
					_Position oldPos; // stack offset -40
					//MATRIX *mat; // $v0

				/* begin block 1.1.3.1 */
					// Start line: 697
					// Start offset: 0x80069128
					// Variables:
						short _x0; // $a2
						short _y0; // $a3
						short _z0; // $t0
						short _x1; // $v0
						short _y1; // $v1
						short _z1; // $a0
				/* end block 1.1.3.1 */
				// End offset: 0x80069128
				// End Line: 697

				/* begin block 1.1.3.2 */
					// Start line: 697
					// Start offset: 0x80069128
					// Variables:
						//short _x0; // $v0
						//short _y0; // $v1
						//short _z0; // $a0
						_Position *_v; // $a1
				/* end block 1.1.3.2 */
				// End offset: 0x80069128
				// End Line: 697
			/* end block 1.1.3 */
			// End offset: 0x80069128
			// End Line: 697
		/* end block 1.1 */
		// End offset: 0x800691D8
		// End Line: 724
	/* end block 1 */
	// End offset: 0x800691D8
	// End Line: 729

	/* begin block 2 */
		// Start line: 1147
	/* end block 2 */
	// End Line: 1148
						UNIMPLEMENTED();
}

// ************** not on pc
// autogenerated function stub: 
// int /*$ra*/ PushPhysOb(struct _Instance *instance /*$s1*/, short x /*stack -32*/, short y /*stack -30*/, short PathNumber /*$a3*/, struct _Instance *Force /*stack 16*/)
int PushPhysOb(struct _Instance *instance, short x, short y, short PathNumber, struct _Instance *Force)
{ // line 733, offset 0x80069200
	/* begin block 1 */
		// Start line: 734
		// Start offset: 0x80069200
		// Variables:
			struct PhysObData *Data; // $s0
			struct PhysObProperties *Prop; // $v1
			int result; // $s2
	/* end block 1 */
	// End offset: 0x8006933C
	// End Line: 784

	/* begin block 2 */
		// Start line: 1536
	/* end block 2 */
	// End Line: 1537
			UNIMPLEMENTED();
	return 0;
}

// ***** not on pc
// autogenerated function stub: 
// void /*$ra*/ ResetSwitchPhysOb(struct _Instance *instance /*$s0*/)
void ResetSwitchPhysOb(struct _Instance *instance)
{ // line 788, offset 0x8006935c
	/* begin block 1 */
		// Start line: 789
		// Start offset: 0x8006935C
		// Variables:
			struct PhysObData *Data; // $v1
			struct PhysObSwitchProperties *Prop; // $a1
	/* end block 1 */
	// End offset: 0x800693E4
	// End Line: 809

	/* begin block 2 */
		// Start line: 1682
	/* end block 2 */
	// End Line: 1683
			UNIMPLEMENTED();
}

// ***** not on pc
// autogenerated function stub: 
// int /*$ra*/ SwitchPhysOb(struct _Instance *instance /*$s1*/)
int SwitchPhysOb(struct _Instance *instance)
{ // line 813, offset 0x800693f4
	/* begin block 1 */
		// Start line: 814
		// Start offset: 0x800693F4
		// Variables:
			struct PhysObData *Data; // $v0
			struct PhysObSwitchProperties *Prop; // $s0
			struct SwitchData *switchData; // $s3
	/* end block 1 */
	// End offset: 0x800695B4
	// End Line: 874

	/* begin block 2 */
		// Start line: 1734
	/* end block 2 */
	// End Line: 1735
			UNIMPLEMENTED();
	return 0;
}

// ***** not on pc
// autogenerated function stub: 
// int /*$ra*/ InteractPhysOb(struct _Instance *instance /*$s1*/, struct _Instance *Force /*$s3*/, int LinkNode /*$s7*/, int Action /*$s4*/)
int InteractPhysOb(struct _Instance *instance, struct _Instance *Force, int LinkNode, int Action)
{ // line 878, offset 0x800695d0
	/* begin block 1 */
		// Start line: 879
		// Start offset: 0x800695D0
		// Variables:
			struct PhysObData *Data; // $s5
			struct PhysObInteractProperties *interactProp; // $s2

		/* begin block 1.1 */
			// Start line: 889
			// Start offset: 0x8006961C
			// Variables:
				struct BreakOffData *BreakOff; // $s6

			/* begin block 1.1.1 */
				// Start line: 900
				// Start offset: 0x80069690
				// Variables:
					struct _Instance *lightInst; // $s0
			/* end block 1.1.1 */
			// End offset: 0x800696A8
			// End Line: 906

			/* begin block 1.1.2 */
				// Start line: 912
				// Start offset: 0x800696D0
				// Variables:
					//struct _Instance *lightInst; // $s0
			/* end block 1.1.2 */
			// End offset: 0x80069700
			// End Line: 921

			/* begin block 1.1.3 */
				// Start line: 958
				// Start offset: 0x80069820
				// Variables:
					//int s; // $s0
			/* end block 1.1.3 */
			// End offset: 0x80069870
			// End Line: 963

			/* begin block 1.1.4 */
				// Start line: 963
				// Start offset: 0x80069878
				// Variables:
					int s; // $s0
			/* end block 1.1.4 */
			// End offset: 0x800698C8
			// End Line: 969
		/* end block 1.1 */
		// End offset: 0x80069904
		// End Line: 987
	/* end block 1 */
	// End offset: 0x80069904
	// End Line: 989

	/* begin block 2 */
		// Start line: 1873
	/* end block 2 */
	// End Line: 1874
					UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// void /*$ra*/ ResetOrientation(struct _Instance *instance /*$s1*/)
void ResetOrientation(struct _Instance* instance)
{ // line 989, offset 0x80069930

	UNIMPLEMENTED();
}

void FinishPush(struct _Instance* instance)
{
	ResetOrientation(instance);
}


// autogenerated function stub: 
// void /*$ra*/ PhysOb_AlignPush(struct _Instance *instance /*$s4*/, int x /*$s5*/, int y /*$s3*/, int path /*$s6*/, struct PhysObData *Data /*stack 16*/)
void PhysOb_AlignPush(struct _Instance *instance, int x, int y, int path, struct PhysObData *Data)
{ // line 1160, offset 0x80069e6c
	UNIMPLEMENTED();
}


// autogenerated function stub: 
// int /*$ra*/ FlipPhysOb(struct _Instance *instance /*$s1*/, short x /*stack -32*/, short y /*stack -30*/, struct _Instance *Force /*$s3*/)
int FlipPhysOb(struct _Instance *instance, short x, short y, struct _Instance *Force)
{ // line 1206, offset 0x80069fdc
	/* begin block 1 */
		// Start line: 1207
		// Start offset: 0x80069FDC
		// Variables:
			struct PhysObData *Data; // $s0
			struct PhysObProperties *Prop; // $v0
			int result; // $s2
	/* end block 1 */
	// End offset: 0x8006A100
	// End Line: 1253

	/* begin block 2 */
		// Start line: 2634
	/* end block 2 */
	// End Line: 2635
			UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ CanBePickedUp(struct _Instance *instance /*$s1*/, struct _Instance *Force /*$s0*/, int LinkNode /*$s2*/)
int CanBePickedUp(struct _Instance *instance, struct _Instance *Force, int LinkNode)
{ // line 1296, offset 0x8006a120
	UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ PickUpPhysOb(struct _Instance *instance /*$s1*/, short Steps /*$a1*/, struct _Instance *Force /*$s3*/, int LinkNode /*$s4*/)
int PickUpPhysOb(struct _Instance *instance, short Steps, struct _Instance *Force, int LinkNode)
{ // line 1361, offset 0x8006a2b8
	/* begin block 1 */
		// Start line: 1362
		// Start offset: 0x8006A2B8
		// Variables:
			struct PhysObData *Data; // $s0

		/* begin block 1.1 */
			// Start line: 1402
			// Start offset: 0x8006A374
			// Variables:
				struct _PhysObLight *pLight; // $v0
		/* end block 1.1 */
		// End offset: 0x8006A38C
		// End Line: 1408
	/* end block 1 */
	// End offset: 0x8006A398
	// End Line: 1414

	/* begin block 2 */
		// Start line: 2996
	/* end block 2 */
	// End Line: 2997
				UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// struct _Instance * /*$ra*/ PHYSOB_BirthCollectible(struct _Instance *parent /*$a0*/, int x /*$s1*/, int y /*$s2*/, int z /*$s3*/, int type /*stack 16*/, int lifeTime /*stack 20*/)
struct _Instance * PHYSOB_BirthCollectible(struct _Instance *parent, int x, int y, int z, int type, int lifeTime)
{ // line 1443, offset 0x8006a3b8
	UNIMPLEMENTED();
	return NULL;
}


struct evObjectBirthProjectileData* PHYSOB_BirthProjectile(struct _Instance* parent, int joint, int type)//Matching - 99.55%
{
	struct evObjectBirthProjectileData* rc;

	rc = (struct evObjectBirthProjectileData*)SetObjectBirthProjectileData(parent, joint, type);

	rc->birthInstance = BirthProjectilePhysOb(parent, joint, type);

	return rc;
}


// autogenerated function stub: 
// struct _Instance * /*$ra*/ BirthProjectilePhysOb(struct _Instance *instance /*$s3*/, int grabJoint /*$s4*/, int type /*$s1*/)
struct _Instance * BirthProjectilePhysOb(struct _Instance *instance, int grabJoint, int type)
{ // line 1484, offset 0x8006a4c0
	/* begin block 1 */
		// Start line: 1485
		// Start offset: 0x8006A4C0
		// Variables:
			struct Object *ForceOb; // $a1
			struct _Instance *iForce; // $s0
			struct PhysObData *Data; // $s2
			struct PhysObProperties *Prop; // $s1

		/* begin block 1.1 */
			// Start line: 1499
			// Start offset: 0x8006A50C
			// Variables:
				struct __PhysObProjectileProperties *ProjProp; // $v1
				struct __PhysObProjectileData *ProjData; // $v1

			/* begin block 1.1.1 */
				// Start line: 1514
				// Start offset: 0x8006A550
				// Variables:
					_Position offset; // stack offset -32
					struct _FXForceFieldEffect *field; // $v1
			/* end block 1.1.1 */
			// End offset: 0x8006A598
			// End Line: 1522

			/* begin block 1.1.2 */
				// Start line: 1535
				// Start offset: 0x8006A5CC
				// Variables:
					//struct __PhysObProjectileData *ProjData; // $v1
			/* end block 1.1.2 */
			// End offset: 0x8006A620
			// End Line: 1547
		/* end block 1.1 */
		// End offset: 0x8006A670
		// End Line: 1569
	/* end block 1 */
	// End offset: 0x8006A674
	// End Line: 1578

	/* begin block 2 */
		// Start line: 3248
	/* end block 2 */
	// End Line: 3249
					UNIMPLEMENTED();
	return null;
}


// autogenerated function stub: 
// void /*$ra*/ PHYSOB_SetLightTable(struct _PhysObLight *pLight /*$a0*/, struct LightInstance *li /*$a1*/, short burnAmplitude /*$a2*/)
void PHYSOB_SetLightTable(struct _PhysObLight *pLight, struct LightInstance *li, short burnAmplitude)
{ // line 1606, offset 0x8006a694
	/* begin block 1 */
		// Start line: 1609
		// Start offset: 0x8006A694
		// Variables:
			long idx; // $a3
			long frac; // $t2
			struct LightTableEntry *ltable; // $t1
			struct LightTableEntry *ltable2; // $a0
	/* end block 1 */
	// End offset: 0x8006A744
	// End Line: 1629

	/* begin block 2 */
		// Start line: 3507
	/* end block 2 */
	// End Line: 3508

	/* begin block 3 */
		// Start line: 3509
	/* end block 3 */
	// End Line: 3510

	/* begin block 4 */
		// Start line: 3513
	/* end block 4 */
	// End Line: 3514
			UNIMPLEMENTED();
}

void PHYSOB_EndLighting(struct _Instance* instance, struct _PhysObLight* pLight)
{
	if (pLight != NULL && gameTrackerX.gameData.asmData.lightInstances[0].lightInstance == instance)
	{
		gameTrackerX.gameData.asmData.lightInstances[0].lightInstance = NULL;
	}
}


// autogenerated function stub: 
// void /*$ra*/ PHYSOB_StartLighting(struct _Instance *instance /*$a0*/, struct _PhysObLight *pLight /*$a3*/)
void PHYSOB_StartLighting(struct _Instance *instance, struct _PhysObLight *pLight)
{ // line 1654, offset 0x8006a820
	/* begin block 1 */
		// Start line: 1655
		// Start offset: 0x8006A820
		// Variables:
			struct PhysObData *Data; // $a2

		/* begin block 1.1 */
			// Start line: 1670
			// Start offset: 0x8006A860
			// Variables:
				struct LightInstance *li; // $a1
		/* end block 1.1 */
		// End offset: 0x8006A87C
		// End Line: 1684
	/* end block 1 */
	// End offset: 0x8006A87C
	// End Line: 1685

	/* begin block 2 */
		// Start line: 3609
	/* end block 2 */
	// End Line: 3610
				UNIMPLEMENTED();
}


// autogenerated function stub: 
// void /*$ra*/ PHYSOB_StartBurnFX(struct _Instance *instance /*$s2*/)
void PHYSOB_StartBurnFX(struct _Instance *instance)
{ // line 1687, offset 0x8006a88c
	/* begin block 1 */
		// Start line: 1688
		// Start offset: 0x8006A88C
		// Variables:
			struct PhysObData *Data; // $v0
			struct Object *object; // $s1
			int i; // $s0
	/* end block 1 */
	// End offset: 0x8006A900
	// End Line: 1704

	/* begin block 2 */
		// Start line: 3678
	/* end block 2 */
	// End Line: 3679
			UNIMPLEMENTED();
}

void PHYSOB_StartBurning(struct _Instance* instance, struct _PhysObLight* pLight)
{ 
	PHYSOB_StartBurnFX(instance);

	PHYSOB_StartLighting(instance, pLight);
}

void PHYSOB_StopLighting(struct _Instance* instance, struct _PhysObLight* pLight)
{
	struct PhysObData* Data;

	Data = (struct PhysObData*)instance->extraData;

	Data->burnAmpl = -4096;

	Data->Mode |= 0x8000;
}

void PHYSOB_StopBurning(struct _Instance* instance, struct _PhysObLight* pLight)
{
	struct PhysObData* Data;

	Data = (struct PhysObData*)instance->extraData;

	Data->burnAmpl = -4096;

	Data->Mode |= 0x48000;
}

void PHYSOB_EndBurning(struct _Instance* instance, struct _PhysObLight* pLight)  // Matching - 100%
{
	struct PhysObData* Data;

	Data = (struct PhysObData*)instance->extraData;
	FX_EndInstanceEffects(instance);
	PHYSOB_EndLighting(instance, pLight);
	Data->burnAmpl = 0;
	Data->Mode &= 0xFFFEFFFF;
}

void StopPhysOb(struct _Instance* instance)
{
	struct PhysObData* Data;

	Data = (struct PhysObData*)instance->extraData;

	Data->Steps = 0;
	Data->Step = 0;
	Data->Segment1 = 1;

	ResetOrientation(instance);

	Data->Mode = 1;
}


void InitPhysicalObject(struct _Instance* instance, struct GameTracker* gameTracker)  // Matching - 100%
{
	struct PhysObData* Data;
	struct PhysObProperties* Prop;
	struct PhysObCollectibleProperties* collectibleProp;
	struct PhysObInteractProperties* interact;
	int s;
	struct _G2SVector3_Type vec;
	struct _G2Matrix_Type mat;
	struct _G2EulerAngles_Type ea;
	struct SwitchData* switchData;
	struct PhysObSwitchProperties* switchProp;
	struct _PhysObLight* pLight;
	struct INICommand* index;

	if ((instance->flags & 0x20000) != 0)
	{
		struct PhysObInteractProperties* interactProp;
		interactProp = (struct PhysObInteractProperties*)instance->data;
		if (interactProp->mode == 2)
		{
			INSTANCE_Post(gameTracker->playerInstance, 0x800024, (int)SetObjectIdleData(0, 0));
		}
		if (CheckPhysObAbility(instance, 8) != 0)
		{
			G2Anim_DetachControllerFromSeg(&instance->anim, 0, 76);
			G2Anim_DetachControllerFromSeg(&instance->anim, 2, 14);
		}
		MEMPACK_Free((char*)instance->extraData);
		return;
	}
	Prop = (struct PhysObProperties*)instance->data;
	Data = (struct PhysObData*)MEMPACK_Malloc(sizeof(struct PhysObData), 26);
	instance->extraData = Data;
	Data->Mode = 1;
	Data->Segment1 = 4097;
	Data->Segment2 = 4098;
	Data->Pad1 = -1;
	Data->burnAmpl = 4096;
	Data->xForce = 0;
	Data->yForce = 0;
	Data->Force = NULL;
	Data->px = 0;
	Data->py = 0;
	Data->pz = 0;
	Data->rx1 = 0;
	Data->ry1 = 0;
	Data->rz1 = 0;
	Data->rx2 = 0;
	Data->ry2 = 0;
	Data->rz2 = 0;
	Data->Steps = 0;
	Data->Step = 0;
	Data->RightCollision = NULL;
	Data->LeftCollision = NULL;
	instance->maxXVel = 640;
	instance->maxYVel = 640;
	instance->maxZVel = 640;
	Data->xRotVel = 0;
	Data->yRotVel = 0;
	Data->zRotVel = 0;
	if (instance->object != NULL)
	{
		if ((instance->object->oflags & 1) == 0)
		{
			Data->Mode |= 0x1000;
		}
	}
	if ((Prop->Type & 64) != 0)
	{
		Prop->Type |= 0x8000;
		instance->flags2 |= 4;
	}
	if ((Prop->Type & 0x8000) != 0)
	{
		G2EmulationInstanceSetTotalSections(instance, 1);
		G2EmulationInstanceSetStartAndEndSegment(instance, 0, 0, (int)instance->object->modelList[instance->currentModel]->numSegments - 1);
		G2EmulationInstanceSetAnimation(instance, 0, 0, 0, 0);
		G2EmulationInstanceSetMode(instance, 0, 2);
	}
	if (Prop->family == 5)
	{
		collectibleProp = (struct PhysObCollectibleProperties*)instance->data;
		G2EmulationInstanceInitSection(instance, 0, PhysobAnimCallback, instance);
		if (collectibleProp->idleAnim != 0xFF)
		{
			G2EmulationInstanceSetAnimation(instance, 0, collectibleProp->idleAnim, 0, 0);
			G2EmulationInstanceSetMode(instance, 0, 2);
		}
		if (collectibleProp->collectClass == 2)
		{
			if (gameTrackerX.playerInstance != NULL)
			{
				if ((INSTANCE_Query(gameTrackerX.playerInstance, 36) & 0xFC0000) == 0)
				{
					instance->flags |= 32;
				}
			}
		}
		if (collectibleProp->collectClass != 3)
		{
			instance->flags2 |= 0x20000;
		}
	}
	if ((Prop->Type & 0x8D00) != 0)
	{
		Data->Mode |= 0x1000;
	}
	if (Prop->family == 3)
	{
		struct PhysObInteractProperties* interactProp;
		interactProp = (struct PhysObInteractProperties*)instance->extraData;
		interactProp->Properties.ID = Prop->Type | 128;
		interactProp->Properties.Type = 0;
		interact = (struct PhysObInteractProperties*)instance->data;
		if ((interact->newType & 128) != 0)
		{
			instance->flags2 |= 0x20000;
		}
		else if ((interact->newType & 1) == 0)
		{
			instance->flags2 |= 4;
		}
		if (instance->object->modelList != NULL)
		{
			if ((interact->startAnimMode & 8) != 0)
			{
				for (s = 0; s < (*instance->object->modelList)->numSegments; s++)
				{
					COLLIDE_SegmentCollisionOff(instance, s);
				}
			}
			else
			{
				for (s = 0; s < (*instance->object->modelList)->numSegments; s++)
				{
					COLLIDE_SegmentCollisionOn(instance, s);
				}
			}
		}
		TurnOffCollisionPhysOb(instance, 7);
		if ((Prop->Type & 0x8000) != 0)
		{
			switch (interact->startAnimMode & 3)
			{
			case 0:
				G2EmulationInstanceSetMode(instance, 0, 2);
				break;
			case 1:
				G2EmulationInstanceSetMode(instance, 0, 1);
				break;
			case 2:
				G2EmulationInstanceSetMode(instance, 0, 0);
				break;
			}
		}
		if (interact->startAnim != 0xFF)
		{
			if ((Prop->Type & 0x8000) != 0)
			{
				G2EmulationInstanceSetAnimation(instance, 0, interact->startAnim, 0, 0);
			}
		}
		if (interact->mode == 2)
		{
			INSTANCE_Post(gameTracker->playerInstance, 0x800024, SetObjectIdleData(1, instance));
		}
	}
	else if (CheckPhysObAbility(instance, 1) != 0)
	{
		TurnOffCollisionPhysOb(instance, 7);
	}
	else if (CheckPhysObAbility(instance, 8) != 0)
	{
		instance->object->oflags |= 0x40000;
		Data->px = instance->position.x;
		Data->py = instance->position.y;
		Data->pz = instance->position.z;
		instance->lightMatrix = 2;
		instance->object->oflags |= 0x400;
		G2EmulationInstanceInitSection(instance, 0, PhysobAnimCallback, instance);
		G2Anim_AttachControllerToSeg(&instance->anim, 0, 76);
		G2Anim_AttachControllerToSeg(&instance->anim, 2, 14);
		G2Anim_DisableController(&instance->anim, 0, 76);
		G2Anim_EnableController(&instance->anim, 2, 14);
		vec.x = instance->rotation.x;
		vec.y = instance->rotation.y;
		vec.z = instance->rotation.z;
		RotMatrixZYX((SVECTOR*)&vec, (MATRIX*)&mat);
		G2EulerAngles_FromMatrix(&ea, &mat, 21);
		vec.x = ea.x;
		vec.y = ea.y;
		vec.z = ea.z;
		instance->rotation.x = 0;
		instance->rotation.y = 0;
		instance->rotation.z = 0;
		G2Anim_SetController_Vector(&instance->anim, 2, 14, &vec);
	}
	else
	{
		if (CheckPhysObAbility(instance, 64) != 0)
		{
			instance->flags2 |= 4;
			switchProp = (struct PhysObSwitchProperties*)instance->data;
			switchData = (struct SwitchData*)instance->extraData + 1;
			switchData->state = switchProp->startMode;
			switchData->accumulator = 0;
			if (switchProp->startAnim == 0xFF)
			{
				switchProp->startAnim = 0;
			}
			G2EmulationInstanceSetAnimation(instance, 0, switchProp->startAnim, 0, 0);
			G2EmulationInstanceInitSection(instance, 0, PhysobAnimCallback, instance);
			if (switchProp->Class == 7)
			{
				switchData->accumulator = 1024;
				G2EmulationInstanceSetAnimation(instance, 0, switchProp->startAnim, 90, 0);
				G2EmulationInstanceSetMode(instance, 0, 1);
				G2EmulationInstancePlayAnimation(instance);
			}
		}
		if (CheckPhysObFamily(instance, 7) != 0)
		{
			G2EmulationInstanceInitSection(instance, 0, PhysobAnimCallback, instance);
			instance->flags2 |= 0x20000;
		}
	}
	if (CheckPhysObAbility(instance, 32) != 0)
	{
		index = INSTANCE_FindIntroCommand(instance, 21);
		pLight = PhysObGetLight(instance);
		if ((pLight != NULL) && ((index == NULL) || ((index->parameter[0] & 1) == 0)))
		{
			Data->burnAmpl = 0;
			PHYSOB_StartBurnFX(instance);
			Data->Mode |= 0x10000;
		}
		else
		{
			PHYSOB_EndBurning(instance, pLight);
		}
	}
	instance->flags |= 0x10000;
	if (CheckPhysObFamily(instance, 6) != 0)
	{
		instance->flags2 |= 0x20000;
	}
	if (CheckPhysObFamily(instance, 0) != 0)
	{
		instance->flags2 |= 256;
	}
}


// autogenerated function stub: 
// void /*$ra*/ ProcessPhysicalObject(struct _Instance *instance /*$s0*/, struct GameTracker *gameTracker /*$s5*/)
void ProcessPhysicalObject(struct _Instance *instance, struct GameTracker *gameTracker)
{ // line 2172, offset 0x8006b2b0
	/* begin block 1 */
		// Start line: 2173
		// Start offset: 0x8006B2B0
		// Variables:
			struct PhysObData *Data; // $s1

		/* begin block 1.1 */
			// Start line: 2182
			// Start offset: 0x8006B2E8
			// Variables:
				struct _PhysObLight *pLight; // $a0

			/* begin block 1.1.1 */
				// Start line: 2189
				// Start offset: 0x8006B2FC
				// Variables:
					struct LightInstance *li; // $a1
			/* end block 1.1.1 */
			// End offset: 0x8006B344
			// End Line: 2195
		/* end block 1.1 */
		// End offset: 0x8006B344
		// End Line: 2196

		/* begin block 1.2 */
			// Start line: 2224
			// Start offset: 0x8006B404
			// Variables:
				struct PhysObWeaponProperties *properties; // $v0

			/* begin block 1.2.1 */
				// Start line: 2230
				// Start offset: 0x8006B434
				// Variables:
					//struct _PhysObLight *pLight; // $a1
			/* end block 1.2.1 */
			// End offset: 0x8006B46C
			// End Line: 2237
		/* end block 1.2 */
		// End offset: 0x8006B46C
		// End Line: 2237

		/* begin block 1.3 */
			// Start line: 2254
			// Start offset: 0x8006B4CC
		/* end block 1.3 */
		// End offset: 0x8006B570
		// End Line: 2274

		/* begin block 1.4 */
			// Start line: 2279
			// Start offset: 0x8006B584
			// Variables:
				struct PhysObAnimatedProperties *Prop; // $v0
		/* end block 1.4 */
		// End offset: 0x8006B5D4
		// End Line: 2287

		/* begin block 1.5 */
			// Start line: 2291
			// Start offset: 0x8006B5E8
		/* end block 1.5 */
		// End offset: 0x8006B630
		// End Line: 2304

		/* begin block 1.6 */
			// Start line: 2358
			// Start offset: 0x8006B738
			// Variables:
				struct PhysObCollectibleProperties *collectibleProp; // $a2
		/* end block 1.6 */
		// End offset: 0x8006B788
		// End Line: 2365

		/* begin block 1.7 */
			// Start line: 2370
			// Start offset: 0x8006B79C
			// Variables:
				struct Level *level; // $s2

			/* begin block 1.7.1 */
				// Start line: 2373
				// Start offset: 0x8006B7C4
				// Variables:
					//struct _PhysObLight *pLight; // $a1
			/* end block 1.7.1 */
			// End offset: 0x8006B800
			// End Line: 2380
		/* end block 1.7 */
		// End offset: 0x8006B800
		// End Line: 2381

		/* begin block 1.8 */
			// Start line: 2385
			// Start offset: 0x8006B814
			// Variables:
				//struct Level *level; // $v1

			/* begin block 1.8.1 */
				// Start line: 2393
				// Start offset: 0x8006B85C
				// Variables:
					struct __PhysObProjectileProperties *ProjProp; // $s2
					struct __PhysObProjectileData *ProjData; // $v1
			/* end block 1.8.1 */
			// End offset: 0x8006B8F4
			// End Line: 2419
		/* end block 1.8 */
		// End offset: 0x8006B8F4
		// End Line: 2420

		/* begin block 1.9 */
			// Start line: 2426
			// Start offset: 0x8006B918
			// Variables:
				struct evPhysicsGravityData *gravityData; // $s2
				int rc; // $s3
				int upperOffset; // $a0
				short lowerOffset; // $a1
				int wasFalling; // $s4

			/* begin block 1.9.1 */
				// Start line: 2509
				// Start offset: 0x8006BB7C
			/* end block 1.9.1 */
			// End offset: 0x8006BB90
			// End Line: 2513

			/* begin block 1.9.2 */
				// Start line: 2540
				// Start offset: 0x8006BC00
			/* end block 1.9.2 */
			// End offset: 0x8006BC28
			// End Line: 2544

			/* begin block 1.9.3 */
				// Start line: 2570
				// Start offset: 0x8006BCDC
				// Variables:
					//struct _PCollideInfo CInfo; // stack offset -96
					SVECTOR Old; // stack offset -48
					SVECTOR New; // stack offset -40
					short len; // $a2
					long mult; // $a3
			/* end block 1.9.3 */
			// End offset: 0x8006BDC0
			// End Line: 2604
		/* end block 1.9 */
		// End offset: 0x8006BDC0
		// End Line: 2604
	/* end block 1 */
	// End offset: 0x8006BEC0
	// End Line: 2658

	/* begin block 2 */
		// Start line: 4820
	/* end block 2 */
	// End Line: 4821
					UNIMPLEMENTED();
}


// autogenerated function stub: 
// unsigned long /*$ra*/ PhysicalObjectQuery(struct _Instance *instance /*$s0*/, unsigned long Query /*$a1*/)
unsigned long PhysicalObjectQuery(struct _Instance *instance, unsigned long Query)
{ // line 2663, offset 0x8006bee4
	/* begin block 1 */
		// Start line: 2664
		// Start offset: 0x8006BEE4
		// Variables:
			struct PhysObData *Data; // $s2
			int trueValue; // $s1

		/* begin block 1.1 */
			// Start line: 2692
			// Start offset: 0x8006BFA4
		/* end block 1.1 */
		// End offset: 0x8006BFC8
		// End Line: 2701

		/* begin block 1.2 */
			// Start line: 2708
			// Start offset: 0x8006BFF8
		/* end block 1.2 */
		// End offset: 0x8006C020
		// End Line: 2711

		/* begin block 1.3 */
			// Start line: 2716
			// Start offset: 0x8006C034
			// Variables:
				struct _G2EulerAngles_Type ea; // stack offset -24
		/* end block 1.3 */
		// End offset: 0x8006C080
		// End Line: 2727

		/* begin block 1.4 */
			// Start line: 2736
			// Start offset: 0x8006C09C
			// Variables:
				struct PhysObProperties *Prop; // $a0

			/* begin block 1.4.1 */
				// Start line: 2740
				// Start offset: 0x8006C0B4
			/* end block 1.4.1 */
			// End offset: 0x8006C0C8
			// End Line: 2743

			/* begin block 1.4.2 */
				// Start line: 2745
				// Start offset: 0x8006C0D0
			/* end block 1.4.2 */
			// End offset: 0x8006C0DC
			// End Line: 2748

			/* begin block 1.4.3 */
				// Start line: 2750
				// Start offset: 0x8006C0E4
			/* end block 1.4.3 */
			// End offset: 0x8006C0F0
			// End Line: 2753
		/* end block 1.4 */
		// End offset: 0x8006C0FC
		// End Line: 2761

		/* begin block 1.5 */
			// Start line: 2771
			// Start offset: 0x8006C130
			// Variables:
				struct PhysObCollectibleProperties *collectibleProp; // $v0
		/* end block 1.5 */
		// End offset: 0x8006C14C
		// End Line: 2774

		/* begin block 1.6 */
			// Start line: 2820
			// Start offset: 0x8006C1A8
			// Variables:
				struct PhysObDraftProperties *DraftProp; // $t0
				struct INICommand *index; // $v0
		/* end block 1.6 */
		// End offset: 0x8006C200
		// End Line: 2832

		/* begin block 1.7 */
			// Start line: 2840
			// Start offset: 0x8006C200
			// Variables:
				struct evControlSaveDataData *pdata; // $a1
				struct _PhysObSaveData *data; // $a2
		/* end block 1.7 */
		// End offset: 0x8006C2D4
		// End Line: 2861

		/* begin block 1.8 */
			// Start line: 2869
			// Start offset: 0x8006C2EC
		/* end block 1.8 */
		// End offset: 0x8006C310
		// End Line: 2881

		/* begin block 1.9 */
			// Start line: 2884
			// Start offset: 0x8006C310
			// Variables:
				//struct PhysObSwitchProperties *Prop; // $v0

			/* begin block 1.9.1 */
				// Start line: 2889
				// Start offset: 0x8006C328
				// Variables:
					//struct PhysObData *Data; // $v0
			/* end block 1.9.1 */
			// End offset: 0x8006C34C
			// End Line: 2901
		/* end block 1.9 */
		// End offset: 0x8006C34C
		// End Line: 2902

		/* begin block 1.10 */
			// Start line: 2912
			// Start offset: 0x8006C36C
			// Variables:
				struct PhysObData *physobData; // $v0
		/* end block 1.10 */
		// End offset: 0x8006C3A4
		// End Line: 2924
	/* end block 1 */
	// End offset: 0x8006C3BC
	// End Line: 2933

	/* begin block 2 */
		// Start line: 5843
	/* end block 2 */
	// End Line: 5844
				UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// void /*$ra*/ PhysicalObjectPost(struct _Instance *instance /*$s4*/, unsigned long Message /*$s0*/, unsigned long Data /*$s3*/)
void PhysicalObjectPost(struct _Instance *instance, unsigned long Message, unsigned long Data)
{ // line 2937, offset 0x8006c3d4
	/* begin block 1 */
		// Start line: 2938
		// Start offset: 0x8006C3D4
		// Variables:
			struct evObjectData *Ptr; // $s2
			struct PhysObData *PData; // $s1

		/* begin block 1.1 */
			// Start line: 2995
			// Start offset: 0x8006C7B8
		/* end block 1.1 */
		// End offset: 0x8006C7D4
		// End Line: 3001

		/* begin block 1.2 */
			// Start line: 3021
			// Start offset: 0x8006C7E4
			// Variables:
				struct PhysObSwitchProperties *Prop; // $s1

			/* begin block 1.2.1 */
				// Start line: 3025
				// Start offset: 0x8006C7F8
			/* end block 1.2.1 */
			// End offset: 0x8006C818
			// End Line: 3034

			/* begin block 1.2.2 */
				// Start line: 3041
				// Start offset: 0x8006C83C
				// Variables:
					//struct PhysObData *Data; // $a0
			/* end block 1.2.2 */
			// End offset: 0x8006C85C
			// End Line: 3050
		/* end block 1.2 */
		// End offset: 0x8006C85C
		// End Line: 3050

		/* begin block 1.3 */
			// Start line: 3058
			// Start offset: 0x8006C870
			// Variables:
				struct _PhysObSaveData *saveData; // $v0

			/* begin block 1.3.1 */
				// Start line: 3073
				// Start offset: 0x8006C8CC
				// Variables:
					struct _PhysObLight *pLight; // $a1
			/* end block 1.3.1 */
			// End offset: 0x8006C8F4
			// End Line: 3080

			/* begin block 1.3.2 */
				// Start line: 3083
				// Start offset: 0x8006C908
				// Variables:
					//struct PhysObSwitchProperties *Prop; // $v1
			/* end block 1.3.2 */
			// End offset: 0x8006C94C
			// End Line: 3099

			/* begin block 1.3.3 */
				// Start line: 3101
				// Start offset: 0x8006C960
			/* end block 1.3.3 */
			// End offset: 0x8006C978
			// End Line: 3105
		/* end block 1.3 */
		// End offset: 0x8006C9AC
		// End Line: 3111

		/* begin block 1.4 */
			// Start line: 3114
			// Start offset: 0x8006C9AC
		/* end block 1.4 */
		// End offset: 0x8006C9B4
		// End Line: 3121

		/* begin block 1.5 */
			// Start line: 3128
			// Start offset: 0x8006C9F4
			// Variables:
				struct PhysObCollectibleProperties *collectibleProp; // $s0
		/* end block 1.5 */
		// End offset: 0x8006CAD4
		// End Line: 3159

		/* begin block 1.6 */
			// Start line: 3161
			// Start offset: 0x8006CAD4
		/* end block 1.6 */
		// End offset: 0x8006CAFC
		// End Line: 3173

		/* begin block 1.7 */
			// Start line: 3199
			// Start offset: 0x8006CB58
			// Variables:
				//struct _PhysObLight *pLight; // $a1

			/* begin block 1.7.1 */
				// Start line: 3213
				// Start offset: 0x8006CBAC
				// Variables:
					struct PhysObData *podata; // $v1
			/* end block 1.7.1 */
			// End offset: 0x8006CBAC
			// End Line: 3213
		/* end block 1.7 */
		// End offset: 0x8006CBD4
		// End Line: 3224

		/* begin block 1.8 */
			// Start line: 3233
			// Start offset: 0x8006CC10
		/* end block 1.8 */
		// End offset: 0x8006CC10
		// End Line: 3234

		/* begin block 1.9 */
			// Start line: 3241
			// Start offset: 0x8006CC1C
		/* end block 1.9 */
		// End offset: 0x8006CC50
		// End Line: 3248

		/* begin block 1.10 */
			// Start line: 3252
			// Start offset: 0x8006CC58
			// Variables:
				//struct PhysObProperties *Prop; // $v0
		/* end block 1.10 */
		// End offset: 0x8006CCA4
		// End Line: 3258
	/* end block 1 */
	// End offset: 0x8006CCA4
	// End Line: 3263

	/* begin block 2 */
		// Start line: 6405
	/* end block 2 */
	// End Line: 6406
					UNIMPLEMENTED();
}


// autogenerated function stub: 
// long /*$ra*/ PhysobAnimCallback(struct _G2Anim_Type *anim /*$v1*/, int sectionID /*$a1*/, enum _G2AnimCallbackMsg_Enum message /*$a2*/, long messageDataA /*$s2*/, long messageDataB /*stack 16*/, void *data /*stack 20*/)
long PhysobAnimCallback(struct _G2Anim_Type *anim, int sectionID, enum _G2AnimCallbackMsg_Enum message, long messageDataA, long messageDataB, void *data)
{ // line 3265, offset 0x8006ccc4
	/* begin block 1 */
		// Start line: 3266
		// Start offset: 0x8006CCC4

		/* begin block 1.1 */
			// Start line: 3268
			// Start offset: 0x8006CCEC
			// Variables:
				struct PhysObData *Data; // $s0
		/* end block 1.1 */
		// End offset: 0x8006CD38
		// End Line: 3285
	/* end block 1 */
	// End offset: 0x8006CD50
	// End Line: 3289

	/* begin block 2 */
		// Start line: 7074
	/* end block 2 */
	// End Line: 7075
				UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// void /*$ra*/ CheckForceCollision(struct _Instance *instance /*$s2*/, struct _Instance *hitinst /*$s4*/, struct _TFace *tface /*$s7*/, struct _CollideInfo *collideInfo /*$fp*/, struct _SVector *dir /*stack 16*/, int obliqueFlg /*stack 20*/)
void CheckForceCollision(struct _Instance *instance, struct _Instance *hitinst, struct _TFace *tface, struct _CollideInfo *collideInfo, _SVector *dir, int obliqueFlg)
{ // line 3300, offset 0x8006cd68
	/* begin block 1 */
		// Start line: 3301
		// Start offset: 0x8006CD68
		// Variables:
			struct PhysObData *Data; // $s3

		/* begin block 1.1 */
			// Start line: 3307
			// Start offset: 0x8006CDBC
			// Variables:
				struct PhysObProperties *Prop; // $s1
				struct ProjectileData *ProjIData; // $s0
				struct __PhysObProjectileData *ProjData; // $s1
				int killImmediately; // $s5
		/* end block 1.1 */
		// End offset: 0x8006CFA4
		// End Line: 3393
	/* end block 1 */
	// End offset: 0x8006CFA4
	// End Line: 3394

	/* begin block 2 */
		// Start line: 7148
	/* end block 2 */
	// End Line: 7149
				UNIMPLEMENTED();
}


// autogenerated function stub: 
// int /*$ra*/ GetObliqueDirection(struct _Instance *instance /*$a0*/, struct _SVector *dir /*$a1*/)
int GetObliqueDirection(struct _Instance *instance, struct _SVector *dir)
{ // line 3397, offset 0x8006cfd4
	/* begin block 1 */
		// Start line: 3398
		// Start offset: 0x8006CFD4
		// Variables:
			struct _SVector vel; // stack offset -8
			int obliqueFlg; // $a3

		/* begin block 1.1 */
			// Start line: 3407
			// Start offset: 0x8006D008
			// Variables:
				long axVel; // $a2
				long ayVel; // $v1
		/* end block 1.1 */
		// End offset: 0x8006D090
		// End Line: 3431
	/* end block 1 */
	// End offset: 0x8006D0A4
	// End Line: 3439

	/* begin block 2 */
		// Start line: 7361
	/* end block 2 */
	// End Line: 7362

	/* begin block 3 */
		// Start line: 7365
	/* end block 3 */
	// End Line: 7366
				UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// void /*$ra*/ CollidePhysicalObject(struct _Instance *instance /*$s1*/, struct GameTracker *gameTracker /*$a1*/)
void CollidePhysicalObject(struct _Instance *instance, struct GameTracker *gameTracker)
{ // line 3444, offset 0x8006d0b0
	/* begin block 1 */
		// Start line: 3445
		// Start offset: 0x8006D0B0
		// Variables:
			struct PhysObData *Data; // $s3
			struct _CollideInfo *collideInfo; // $s2
			int obliqueFlg; // stack offset -48
			struct _SVector vel; // stack offset -136
			struct _SVector dir; // stack offset -128
			struct _Instance *hitinst; // $s5
			struct _TFace *tface; // $s4
			struct _Normal *norm; // $s6
			struct _SVector normal; // stack offset -120
			int stickFlg; // $s0
			int drawFlg; // $s7
			int projectile; // $fp

		/* begin block 1.1 */
			// Start line: 3470
			// Start offset: 0x8006D10C
			// Variables:
				struct Level *level; // $v1
		/* end block 1.1 */
		// End offset: 0x8006D154
		// End Line: 3480

		/* begin block 1.2 */
			// Start line: 3487
			// Start offset: 0x8006D170
			// Variables:
				struct BSPTree *bsp; // $s0
				//struct Level *level; // $a0
		/* end block 1.2 */
		// End offset: 0x8006D1C4
		// End Line: 3494

		/* begin block 1.3 */
			// Start line: 3517
			// Start offset: 0x8006D298
			// Variables:
				_Position delta; // stack offset -112

			/* begin block 1.3.1 */
				// Start line: 3519
				// Start offset: 0x8006D298
				// Variables:
					short _x0; // $t0
					short _y0; // $t1
					short _z0; // $t2
					short _x1; // $v0
					short _y1; // $v1
					short _z1; // $a2
					_Position *_v; // $a1
					_Position *_v0; // $v0
					_Position *_v1; // $a3
			/* end block 1.3.1 */
			// End offset: 0x8006D298
			// End Line: 3519

			/* begin block 1.3.2 */
				// Start line: 3519
				// Start offset: 0x8006D298
				// Variables:
					//short _x0; // $v0
					//short _y0; // $v1
					//short _z0; // $a2
			/* end block 1.3.2 */
			// End offset: 0x8006D298
			// End Line: 3519
		/* end block 1.3 */
		// End offset: 0x8006D31C
		// End Line: 3525

		/* begin block 1.4 */
			// Start line: 3569
			// Start offset: 0x8006D440
		/* end block 1.4 */
		// End offset: 0x8006D474
		// End Line: 3574

		/* begin block 1.5 */
			// Start line: 3583
			// Start offset: 0x8006D4B0
			// Variables:
				//struct _PCollideInfo CInfo; // stack offset -104
				struct _SVector newPos; // stack offset -56
		/* end block 1.5 */
		// End offset: 0x8006D50C
		// End Line: 3602

		/* begin block 1.6 */
			// Start line: 3622
			// Start offset: 0x8006D5B4
			// Variables:
				//_Position delta; // stack offset -112

			/* begin block 1.6.1 */
				// Start line: 3622
				// Start offset: 0x8006D5B4
				// Variables:
					//short _x0; // $v0
					//short _y0; // $v1
					//short _z0; // $a2
					//short _y1; // $t1
					//short _z1; // $t2
					//_Position *_v; // $a3
			/* end block 1.6.1 */
			// End offset: 0x8006D5B4
			// End Line: 3622
		/* end block 1.6 */
		// End offset: 0x8006D624
		// End Line: 3642

		/* begin block 1.7 */
			// Start line: 3645
			// Start offset: 0x8006D634
		/* end block 1.7 */
		// End offset: 0x8006D68C
		// End Line: 3651

		/* begin block 1.8 */
			// Start line: 3684
			// Start offset: 0x8006D758
			// Variables:
				//struct _CollideInfo parentCI; // stack offset -112
		/* end block 1.8 */
		// End offset: 0x8006D7B0
		// End Line: 3690

		/* begin block 1.9 */
			// Start line: 3698
			// Start offset: 0x8006D7E8
			// Variables:
				struct PhysObSplinter *splintDef; // $v0
				struct FXSplinter *splinterData; // $v1
		/* end block 1.9 */
		// End offset: 0x8006D830
		// End Line: 3721
	/* end block 1 */
	// End offset: 0x8006D854
	// End Line: 3726

	/* begin block 2 */
		// Start line: 7463
	/* end block 2 */
	// End Line: 7464
				UNIMPLEMENTED();
}


// autogenerated function stub: 
// struct PhysObWeaponAttributes * /*$ra*/ PhysObGetWeapon(struct _Instance *instance /*$s1*/)
struct PhysObWeaponAttributes * PhysObGetWeapon(struct _Instance *instance)
{ // line 3729, offset 0x8006d884
	/* begin block 1 */
		// Start line: 3730
		// Start offset: 0x8006D884
		// Variables:
			struct PhysObWeaponAttributes *weapon; // $s0

		/* begin block 1.1 */
			// Start line: 3736
			// Start offset: 0x8006D8AC
			// Variables:
				struct PhysObWeaponProperties *Prop; // $v0
		/* end block 1.1 */
		// End offset: 0x8006D8B8
		// End Line: 3738

		/* begin block 1.2 */
			// Start line: 3740
			// Start offset: 0x8006D8C8
			// Variables:
				//struct PhysObInteractProperties *Prop; // $v0
		/* end block 1.2 */
		// End offset: 0x8006D8D4
		// End Line: 3742

		/* begin block 1.3 */
			// Start line: 3744
			// Start offset: 0x8006D8E4
			// Variables:
				//struct __PhysObProjectileProperties *Prop; // $a0
		/* end block 1.3 */
		// End offset: 0x8006D90C
		// End Line: 3748
	/* end block 1 */
	// End offset: 0x8006D90C
	// End Line: 3749

	/* begin block 2 */
		// Start line: 8132
	/* end block 2 */
	// End Line: 8133
				UNIMPLEMENTED();
	return null;
}

struct _PhysObLight* PhysObGetLight(struct _Instance* instance)
{
	struct PhysObWeaponAttributes* weapon;
	struct _PhysObLight* pLight;
	
	pLight = NULL;

	weapon = PhysObGetWeapon(instance);

	if (weapon != NULL)
	{
		pLight = weapon->Light;
	}

	return pLight;
}

struct PhysObSplinter* PhysObGetSplinter(struct _Instance* instance)
{
	struct PhysObWeaponAttributes* weapon;
	struct PhysObSplinter* pSplinter;

	pSplinter = NULL;
	weapon = PhysObGetWeapon(instance);

	if (weapon != NULL)
	{
		pSplinter = &weapon->splinter;
	}

	return pSplinter;
}


// autogenerated function stub: 
// void /*$ra*/ TurnOnCollisionPhysOb(struct _Instance *instance /*$s1*/, int coll /*$s2*/)
void TurnOnCollisionPhysOb(struct _Instance *instance, int coll)
{ // line 3783, offset 0x8006d994
	/* begin block 1 */
		// Start line: 3784
		// Start offset: 0x8006D994
		// Variables:
			struct PhysObWeaponAttributes *weapon; // $s0
			struct PhysObData *Data; // $v1
	/* end block 1 */
	// End offset: 0x8006DA20
	// End Line: 3802

	/* begin block 2 */
		// Start line: 8244
	/* end block 2 */
	// End Line: 8245
			UNIMPLEMENTED();
}


void TurnOffCollisionPhysOb(struct _Instance* instance, int coll)  // Matching - 100%
{
	struct PhysObWeaponAttributes* weapon;

	weapon = PhysObGetWeapon(instance);
	if (weapon != NULL)
	{
		if ((coll & 2) != 0)
		{
			COLLIDE_SegmentCollisionOff(instance, *(signed char*)(&weapon->LeftHandSphere));
		}
		if ((coll & 1) != 0)
		{
			COLLIDE_SegmentCollisionOff(instance, *(signed char*)(&weapon->RightHandSphere));
		}
		if ((coll & 4) != 0)
		{
			COLLIDE_SegmentCollisionOff(instance, *(signed char*)(&weapon->ThrowSphere));
		}
	}
}

// autogenerated function stub: 
// int /*$ra*/ GetPhysObCollisionType(struct _Instance *instance /*$s1*/)
int GetPhysObCollisionType(struct _Instance *instance)
{ // line 3831, offset 0x8006dac0
	/* begin block 1 */
		// Start line: 3832
		// Start offset: 0x8006DAC0
		// Variables:
			struct _CollideInfo *collideInfo; // $s4
			struct _HSphere *S; // $s0
			struct _Instance *target; // $s2
			struct PhysObWeaponAttributes *weapon; // $s0
			struct PhysObData *Data; // $s5

		/* begin block 1.1 */
			// Start line: 3851
			// Start offset: 0x8006DB38
			// Variables:
				struct _Instance *inst; // $v1
		/* end block 1.1 */
		// End offset: 0x8006DB38
		// End Line: 3851

		/* begin block 1.2 */
			// Start line: 3919
			// Start offset: 0x8006DD18
			// Variables:
				int damage; // $s3
		/* end block 1.2 */
		// End offset: 0x8006DD74
		// End Line: 3925
	/* end block 1 */
	// End offset: 0x8006DDD8
	// End Line: 3941

	/* begin block 2 */
		// Start line: 8347
	/* end block 2 */
	// End Line: 8348
				UNIMPLEMENTED();
	return 0;
}


void ExecuteThrow(struct _Instance* instance) // Matching - 100%
{
	struct PhysObData* Data;

	Data = (struct PhysObData*)instance->extraData;

	if ((Data->throwFlags & 1))
	{
		short angley;
		struct _Position zero;
		struct _Position velocity;

		memset(&zero, 0, 6);

		velocity.x = (short)instance->xVel;
		velocity.y = (short)instance->yVel;
		velocity.z = (short)instance->zVel;

		angley = MATH3D_AngleFromPosToPos(&zero, &velocity);

		instance->rotation.x = Data->initialXRot + MATH3D_ElevationFromPosToPos(&zero, &velocity);
		instance->rotation.z = angley;
		instance->rotation.y = 0;

		MATH3D_ZYXtoXYZ(&instance->rotation);
	}
	else
	{
		instance->rotation.x += Data->xRotVel;
		instance->rotation.y += Data->yRotVel;
		instance->rotation.z += Data->zRotVel;
	}

	Data->physObTimer -= gameTrackerX.timeMult;

	if (Data->physObTimer < 0)
	{
		INSTANCE_KillInstance(instance);
	}
}


void ExecuteDrag(struct _Instance* instance) // Matching - 100%
{
	struct PhysObData* Data;

	Data = (struct PhysObData*)instance->extraData;

	if ((Data->Mode & 0x2))
	{
		Data->Mode &= ~0x2;
	}

	if ((Data->Mode & 0x100000))
	{
		Data->Force = 0;

		FinishPush(instance);

		Data->Mode = ((Data->Mode & ~0x10014A) | 0x1);

		instance->initialPos = instance->position;
	}
	else
	{
		G2EmulationInstancePlayAnimation(instance);
	}
}


void ExecuteSlideToStop(struct _Instance* instance) // Matching - 100%
{
	struct PhysObData* Data;

	Data = (struct PhysObData*)instance->extraData;

	if ((Data->Mode & 0x100000))
	{
		if ((Data->Mode & 0x4000000))
		{
			Data->Mode &= ~0x410114A;

			if (!(Data->Mode & 0x4))
			{
				Data->Mode |= 0x1;
			}
		}
		else
		{
			Data->Force = 0;

			FinishPush(instance);

			Data->Mode = ((Data->Mode & ~0x1000) | 0x4000000);

			instance->initialPos = instance->position;
		}
	}
	else
	{
		G2EmulationInstancePlayAnimation(instance);
	}
}


void ExecuteFlip(struct _Instance* instance) // Matching - 100%
{
	struct PhysObData* Data;

	Data = (struct PhysObData*)instance->extraData;

	if ((Data->Mode & 0x2))
	{
		Data->Mode &= ~0x2;
	}

	if ((Data->Mode & 0x100000))
	{
		if ((Data->Mode & 0x4000000))
		{
			Data->Mode &= ~0x410114A;

			if (!(Data->Mode & 0x4))
			{
				Data->Mode |= 0x1;
			}
		}
		else
		{
			if (Data->PathNumber == 14)
			{
				instance->zVel = -50;
			}

			ResetOrientation(instance);

			Data->Force = 0;
			Data->Mode = ((Data->Mode & ~0x1000) | 0x4000000);

			instance->initialPos = instance->position;
		}
	}
	else
	{
		G2EmulationInstancePlayAnimation(instance);
	}
}

int CheckSlope(int Znormal, int Slope, int Slop) // Matching - 100%
{
	int result;  // not from SYMDUMP

	result = 0;

	if ((Slope - Slop) < Znormal)
	{
		result = Znormal < (Slope + Slop);
	}

	return result;
}


// autogenerated function stub: 
// int /*$ra*/ CheckBlockSlope(struct _Instance *instance /*$a0*/, int x /*$a1*/, int y /*$a2*/, int hOff /*$a3*/, int vOff /*stack 16*/, int dH /*stack 20*/, int dV /*stack 24*/)
int CheckBlockSlope(struct _Instance *instance, int x, int y, int hOff, int vOff, int dH, int dV)
{ // line 4177, offset 0x8006e184
	/* begin block 1 */
		// Start line: 4178
		// Start offset: 0x8006E184
		// Variables:
			//struct _PCollideInfo CInfo; // stack offset -72
			//SVECTOROld; // stack offset -24
			//SVECTORNew; // stack offset -16
			int xOff; // $t3
			int yOff; // $t4
			int dX; // $t2
			int dY; // $t6
			//MATRIX *mat; // $v0
	/* end block 1 */
	// End offset: 0x8006E184
	// End Line: 4178

	/* begin block 2 */
		// Start line: 9068
	/* end block 2 */
	// End Line: 9069

	/* begin block 3 */
		// Start line: 9071
	/* end block 3 */
	// End Line: 9072
			UNIMPLEMENTED();
	return 0;
}


int PHYSOBS_FigureDragForSlope(struct _Instance* instance, int pathNumber, int* result) // Matching - 100%
{
	int didSomething;

	didSomething = 0;

	do
	{

	} while (FALSE);  // garbage code for reodering

	if ((PHYSOBS_IsAPushBlockAttached(instance) != NULL) || (pathNumber == 5) || (pathNumber == 1) || (pathNumber == 7) || (pathNumber == 4) || (pathNumber == 2) || (didSomething = 0, (pathNumber == 3)))
	{
		*result = 0;
		didSomething = 1;
	}

	return didSomething;
}


// autogenerated function stub: 
// int /*$ra*/ PHYSOB_CheckThrownLineCollision(struct _Instance *instance /*$s3*/, struct _Instance *parent /*$s1*/)
int PHYSOB_CheckThrownLineCollision(struct _Instance *instance, struct _Instance *parent)
{ // line 4255, offset 0x8006e2c4
	/* begin block 1 */
		// Start line: 4256
		// Start offset: 0x8006E2C4
		// Variables:
			//struct _PCollideInfo pcollideInfo; // stack offset -160
			_Position newPos; // stack offset -112
			_Position oldPos; // stack offset -104
			_Position orgNew; // stack offset -96
			//MATRIX *mat; // $v1
			struct PhysObWeaponAttributes *weapon; // $v0

		/* begin block 1.1 */
			// Start line: 4280
			// Start offset: 0x8006E32C
			// Variables:
				struct _SVector line; // stack offset -88
				struct _SVector delta; // stack offset -80
				long dp; // $s0

			/* begin block 1.1.1 */
				// Start line: 4312
				// Start offset: 0x8006E3DC
				// Variables:
					short _x0; // $a0
					short _y0; // $v0
					short _z0; // $v1
					short _y1; // $a1
					short _z1; // $a2
					struct _SVector *_v; // $s1
					_Position *_v0; // $v1
					_Position *_v1; // $s2
			/* end block 1.1.1 */
			// End offset: 0x8006E3DC
			// End Line: 4312

			/* begin block 1.1.2 */
				// Start line: 4316
				// Start offset: 0x8006E488
				// Variables:
					//short _x0; // $v0
					//short _y0; // $v1
					//short _z0; // $a0
					//short _y1; // $a1
					//short _z1; // $a2
			/* end block 1.1.2 */
			// End offset: 0x8006E488
			// End Line: 4316

			/* begin block 1.1.3 */
				// Start line: 4326
				// Start offset: 0x8006E4D8
				// Variables:
					//short _x1; // $a2
					//short _y1; // $v1
					//short _z1; // $a3
					//_Position *_v0; // $v0
					//_Position *_v1; // $v0
			/* end block 1.1.3 */
			// End offset: 0x8006E4D8
			// End Line: 4326
		/* end block 1.1 */
		// End offset: 0x8006E580
		// End Line: 4338

		/* begin block 1.2 */
			// Start line: 4349
			// Start offset: 0x8006E5B4
			// Variables:
				struct _TFace *tface; // $a0
				struct Level *level; // $a1
		/* end block 1.2 */
		// End offset: 0x8006E604
		// End Line: 4355

		/* begin block 1.3 */
			// Start line: 4363
			// Start offset: 0x8006E604
			// Variables:
				//short _x0; // $t0
				//short _y0; // $t1
				//short _z0; // $t2
				//short _x1; // $v0
				//short _y1; // $v1
				//short _z1; // $a2
				//_Position *_v; // $a1
				//_Position *_v0; // $v0
		/* end block 1.3 */
		// End offset: 0x8006E604
		// End Line: 4363

		/* begin block 1.4 */
			// Start line: 4363
			// Start offset: 0x8006E604
			// Variables:
				//short _x0; // $v0
				//short _y0; // $v1
				//short _z0; // $a2
				//_Position *_v; // $a3
		/* end block 1.4 */
		// End offset: 0x8006E604
		// End Line: 4363

		/* begin block 1.5 */
			// Start line: 4363
			// Start offset: 0x8006E604
			// Variables:
				struct PhysObData *Data; // $s0

			/* begin block 1.5.1 */
				// Start line: 4377
				// Start offset: 0x8006E6A8
				// Variables:
					struct PhysObSplinter *splintDef; // $v0
					struct FXSplinter *splinterData; // $v1
			/* end block 1.5.1 */
			// End offset: 0x8006E6F0
			// End Line: 4392

			/* begin block 1.5.2 */
				// Start line: 4395
				// Start offset: 0x8006E6F0
				// Variables:
					struct _SVector dir; // stack offset -80
					struct _Instance *hitInst; // $s1
					//struct _TFace *tface; // $s2
					//struct _CollideInfo collideInfo; // stack offset -72
			/* end block 1.5.2 */
			// End offset: 0x8006E714
			// End Line: 4406
		/* end block 1.5 */
		// End offset: 0x8006E714
		// End Line: 4406

		/* begin block 1.6 */
			// Start line: 4414
			// Start offset: 0x8006E760
			// Variables:
				//struct Level *level; // $v0
				//int bspID; // $a0
				//struct BSPTree *bsp; // $v0
		/* end block 1.6 */
		// End offset: 0x8006E768
		// End Line: 4425
	/* end block 1 */
	// End offset: 0x8006E7A0
	// End Line: 4426

	/* begin block 2 */
		// Start line: 9290
	/* end block 2 */
	// End Line: 9291
					UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ PHYSOB_CheckDroppedLineCollision(struct _Instance *instance /*$s3*/, struct _Instance *parent /*$s6*/)
int PHYSOB_CheckDroppedLineCollision(struct _Instance *instance, struct _Instance *parent)
{ // line 4432, offset 0x8006e7bc
	/* begin block 1 */
		// Start line: 4433
		// Start offset: 0x8006E7BC
		// Variables:
			//struct _PCollideInfo pcollideInfo; // stack offset -208
			_Position parentPos; // stack offset -160
			_Position newPos; // stack offset -152
			_Position oldPos; // stack offset -144
			struct _SVector offset; // stack offset -136
			_Position basePos; // stack offset -128
			int seg; // $s2
			int collided; // $s5

		/* begin block 1.1 */
			// Start line: 4466
			// Start offset: 0x8006E848
			// Variables:
				//MATRIX *mat; // $v1

			/* begin block 1.1.1 */
				// Start line: 4468
				// Start offset: 0x8006E848
				// Variables:
					short _y0; // $v1
					short _z0; // $a0
					short _y1; // $t0
					short _z1; // $t1
					struct _SVector *_v; // $s1
					_Position *_v0; // $s0
					_Position *_v1; // $s4
			/* end block 1.1.1 */
			// End offset: 0x8006E848
			// End Line: 4468

			/* begin block 1.1.2 */
				// Start line: 4479
				// Start offset: 0x8006E948
				// Variables:
					//short _y0; // $v1
					//short _z0; // $a1
			/* end block 1.1.2 */
			// End offset: 0x8006E948
			// End Line: 4479
		/* end block 1.1 */
		// End offset: 0x8006E9D4
		// End Line: 4495

		/* begin block 1.2 */
			// Start line: 4496
			// Start offset: 0x8006E9F4
			// Variables:
				struct _SVector origin; // stack offset -120
				struct _SVector node2; // stack offset -112
				struct _SVector orgDir; // stack offset -104
				struct _SVector newDir; // stack offset -96
				struct _SVector axis; // stack offset -88
				short angle; // $s0
				//MATRIX mat; // stack offset -80
				struct _G2EulerAngles_Type ea; // stack offset -48

			/* begin block 1.2.1 */
				// Start line: 4496
				// Start offset: 0x8006E9F4
				// Variables:
					//short _y0; // $v0
					//short _z0; // $v1
					//short _y1; // $a3
					//short _z1; // $a1
					///struct _SVector *_v; // $s0
					//struct _SVector *_v0; // $v1
					//struct _SVector *_v1; // $a1
			/* end block 1.2.1 */
			// End offset: 0x8006E9F4
			// End Line: 4496

			/* begin block 1.2.2 */
				// Start line: 4496
				// Start offset: 0x8006E9F4
				// Variables:
					//struct _SVector delta; // stack offset -40
					//int i; // $a0
					//struct _Model *model; // $a2
					//MATRIX *m; // $a1
			/* end block 1.2.2 */
			// End offset: 0x8006EC40
			// End Line: 4546
		/* end block 1.2 */
		// End offset: 0x8006EC40
		// End Line: 4547
	/* end block 1 */
	// End offset: 0x8006EC50
	// End Line: 4562

	/* begin block 2 */
		// Start line: 9698
	/* end block 2 */
	// End Line: 9699
				UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ PHYSOB_CheckDirectedLineCollision(struct _Instance *instance /*$a0*/, int xoffset /*$a1*/, int yoffset /*$a2*/, int startZOffset /*$a3*/)
int PHYSOB_CheckDirectedLineCollision(struct _Instance *instance, int xoffset, int yoffset, int startZOffset)
{ // line 4566, offset 0x8006ec78
	/* begin block 1 */
		// Start line: 4567
		// Start offset: 0x8006EC78
		// Variables:
			//struct _PCollideInfo pcollideInfo; // stack offset -72
			_Position newPos; // stack offset -24
			_Position oldPos; // stack offset -16
			//MATRIX *mat; // $v0
	/* end block 1 */
	// End offset: 0x8006EC78
	// End Line: 4567

	/* begin block 2 */
		// Start line: 10074
	/* end block 2 */
	// End Line: 10075
			UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// long /*$ra*/ PHYSOBS_CheckForStackedForwardHits(struct _Instance *block /*$a0*/, long xoffset /*$s2*/, long yoffset /*$s3*/)
long PHYSOBS_CheckForStackedForwardHits(struct _Instance *block, long xoffset, long yoffset)
{ // line 4587, offset 0x8006ecec
	/* begin block 1 */
		// Start line: 4588
		// Start offset: 0x8006ECEC
		// Variables:
			struct _Instance *attachedBlock; // $s0
			long result; // $s1
	/* end block 1 */
	// End offset: 0x8006ED48
	// End Line: 4607

	/* begin block 2 */
		// Start line: 10140
	/* end block 2 */
	// End Line: 10141
			UNIMPLEMENTED();
	return 0;
}


void PHYSOBS_SetNewAnim(struct _Instance* instance, struct PhysObData* Data, unsigned long modeBits, int path, int resetflg)  // Matching - 100%
{
	Data->PathNumber = (short)path;
	Data->Mode = Data->Mode & 0xFFFFFFFE | modeBits;
	if (resetflg != 0)
	{
		ResetOrientation(instance);
	}
	PhysOb_AlignPush(instance, (int)Data->xForce, (int)Data->yForce, path, Data);
}


// autogenerated function stub: 
// long /*$ra*/ PHYSOB_CheckForEnemyInBlkSpot(struct _Instance *instance /*$a0*/, int dx /*$a1*/, int dy /*$a2*/)
long PHYSOB_CheckForEnemyInBlkSpot(struct _Instance *instance, int dx, int dy)
{ // line 4623, offset 0x8006ede0
	/* begin block 1 */
		// Start line: 4624
		// Start offset: 0x8006EDE0
		// Variables:
			int x; // $v0
			int y; // $v1
			int z; // $v0
			int x0; // $s6
			int x1; // $s5
			int y0; // $s4
			int y1; // $s3
			int z0; // $s2
			int z1; // $s1
			struct _Instance *inst; // $s0
	/* end block 1 */
	// End offset: 0x8006EEEC
	// End Line: 4646

	/* begin block 2 */
		// Start line: 10217
	/* end block 2 */
	// End Line: 10218
			UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// long /*$ra*/ PHYSOBS_CheckForValidMove(struct _Instance *instance /*$s2*/)
long PHYSOBS_CheckForValidMove(struct _Instance *instance)
{ // line 4649, offset 0x8006ef14
	/* begin block 1 */
		// Start line: 4650
		// Start offset: 0x8006EF14
		// Variables:
			int rc; // $s1
			struct PhysObData *Data; // $s0
			struct evPhysicsSlideData *Ptr; // stack offset -32
			int result; // stack offset -28

		/* begin block 1.1 */
			// Start line: 4735
			// Start offset: 0x8006F070
			// Variables:
				int Height; // $v0
		/* end block 1.1 */
		// End offset: 0x8006F0C0
		// End Line: 4748

		/* begin block 1.2 */
			// Start line: 4972
			// Start offset: 0x8006F32C
			// Variables:
				//struct evPhysicsSlideData *Ptr; // stack offset -24
		/* end block 1.2 */
		// End offset: 0x8006F420
		// End Line: 5017
	/* end block 1 */
	// End offset: 0x8006F444
	// End Line: 5033

	/* begin block 2 */
		// Start line: 10284
	/* end block 2 */
	// End Line: 10285
				UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// void /*$ra*/ ExecuteGravitate(struct _Instance *instance /*$s1*/)
void ExecuteGravitate(struct _Instance *instance)
{ // line 5037, offset 0x8006f460
	/* begin block 1 */
		// Start line: 5038
		// Start offset: 0x8006F460
		// Variables:
			struct PhysObData *Data; // $s0
			struct _Instance *Force; // $s4
			struct _G2EulerAngles_Type ea; // stack offset -48
			struct _Vector Position; // stack offset -40
			struct _Model *model; // $s3
			//MATRIX *forceMatrix; // $s2
			int scale; // $v1
	/* end block 1 */
	// End offset: 0x8006F7B4
	// End Line: 5154

	/* begin block 2 */
		// Start line: 11082
	/* end block 2 */
	// End Line: 11083
			UNIMPLEMENTED();
}

void ExecuteFollow(struct _Instance* instance)//Matching - 100%
{
	struct PhysObData* Data;
	struct _Instance* Force;

	Data = (struct PhysObData*)instance->extraData;

	Force = Data->Force;

	instance->position.x = (short)Force->matrix[Data->Segment1].t[0] + Data->px;
	instance->position.y = (short)Force->matrix[Data->Segment1].t[1] + Data->py;
}


void PHYSOB_Normalize(struct _SVector* v) // Matching - 100%
{
	long len;

	len = MATH3D_SquareLength(v->x, v->y, v->z);

	if (len != 0)
	{
		len = MATH3D_FastSqrt0(len);
	}
	else
	{
		len = 1;
	}

	v->x = (short)((v->x << 12) / len);
	v->y = (short)((v->y << 12) / len);
	v->z = (short)((v->z << 12) / len);
}


// autogenerated function stub: 
// int /*$ra*/ PHYSOB_MoveTowardsAlign(struct _Instance *instance /*$s2*/, struct _SVector *orgVec /*$s0*/, struct _SVector *endVec /*$s1*/)
int PHYSOB_MoveTowardsAlign(struct _Instance *instance, struct _SVector *orgVec, struct _SVector *endVec)
{ // line 5194, offset 0x8006f8c8
	/* begin block 1 */
		// Start line: 5195
		// Start offset: 0x8006F8C8
		// Variables:
			//MATRIX xform; // stack offset -104
			//MATRIX dest; // stack offset -72
			//MATRIX *src; // $s4
			struct _G2Quat_Type rot; // stack offset -40
			long len; // $s0
			int theta; // $s1
			int sintheta; // $v0
			struct _G2EulerAngles_Type ea; // stack offset -32
	/* end block 1 */
	// End offset: 0x8006FAAC
	// End Line: 5239

	/* begin block 2 */
		// Start line: 11440
	/* end block 2 */
	// End Line: 11441
			UNIMPLEMENTED();
	return 0;
}


// autogenerated function stub: 
// int /*$ra*/ PHYSOB_ReAlignFalling(struct _Instance *instance /*$s5*/, int zEndOff /*$fp*/)
int PHYSOB_ReAlignFalling(struct _Instance *instance, int zEndOff)
{ // line 5257, offset 0x8006fba0
	/* begin block 1 */
		// Start line: 5258
		// Start offset: 0x8006FBA0
		// Variables:
			struct _Model *model; // $s6
			int i; // $s2
			_Position seg0; // stack offset -208
			_Position segn; // stack offset -200
			_Position start0; // stack offset -192
			_Position startn; // stack offset -184
			int startFlg; // $s3
			short zOff; // $s7

		/* begin block 1.1 */
			// Start line: 5309
			// Start offset: 0x8006FC08
			// Variables:
				//struct _PCollideInfo pcollideInfo; // stack offset -176
				_Position newPos; // stack offset -128
				_Position oldPos; // stack offset -120
				short x; // $s1
				short y; // $s0
				//MATRIX *mat; // $v0

			/* begin block 1.1.1 */
				// Start line: 5328
				// Start offset: 0x8006FC80
				// Variables:
					short ax; // $a1
					short ay; // $a2
			/* end block 1.1.1 */
			// End offset: 0x8006FD78
			// End Line: 5358

			/* begin block 1.1.2 */
				// Start line: 5366
				// Start offset: 0x8006FDA4
			/* end block 1.1.2 */
			// End offset: 0x8006FE90
			// End Line: 5394
		/* end block 1.1 */
		// End offset: 0x8006FE90
		// End Line: 5396

		/* begin block 1.2 */
			// Start line: 5403
			// Start offset: 0x8006FEAC
			// Variables:
				short _x0; // $a3
				short _y0; // $v0
				short _z0; // $v1
				short _x1; // $a1
				short _y1; // $t0
				short _z1; // $a2
				_Position *_v; // $a0
				_Position *_v1; // $a2
		/* end block 1.2 */
		// End offset: 0x8006FEAC
		// End Line: 5403

		/* begin block 1.3 */
			// Start line: 5403
			// Start offset: 0x8006FEAC
			// Variables:
				//short _x0; // $v0
				//short _y0; // $v1
				//short _z0; // $a0
				//short _x1; // $a2
				//short _y1; // $t1
				//short _z1; // $t0
				//_Position *_v; // $a1
				//_Position *_v1; // $t0
		/* end block 1.3 */
		// End offset: 0x8006FEAC
		// End Line: 5403

		/* begin block 1.4 */
			// Start line: 5425
			// Start offset: 0x8006FFB4
			// Variables:
				//struct _PCollideInfo pcollideInfo; // stack offset -112
				//_Position newPos; // stack offset -64
				//_Position oldPos; // stack offset -56
				//_Position deltaPos; // stack offset -48
				//MATRIX *mat; // $a2
		/* end block 1.4 */
		// End offset: 0x80070058
		// End Line: 5481
	/* end block 1 */
	// End offset: 0x80070094
	// End Line: 5485

	/* begin block 2 */
		// Start line: 11588
	/* end block 2 */
	// End Line: 11589
				UNIMPLEMENTED();
	return 0;
}


void DropPhysOb(struct _Instance* instance, int flags) // Matching - 100%
{
	struct PhysObData* Data;
	struct _Instance* parent;
	int temp;  // not from SYMDUMP

	parent = instance->LinkParent;

	Data = (struct PhysObData*)instance->extraData;

	if (parent != NULL)
	{
		INSTANCE_UnlinkFromParent(instance);
	}
	else
	{
		Data->Mode &= ~0x800000;
	}

	PHYSOB_CheckDroppedLineCollision(instance, parent);

	if ((flags & 2))
	{
		Data->Mode = ((Data->Mode & ~0x90) | 0x1000);

		instance->zAccl = 0;
	}
	else
	{
		if (!(flags & 4))
		{
			temp = 0;

			if (parent != NULL)
			{
				temp = -900;
			}

			PHYSOB_ReAlignFalling(instance, temp);
		}

		Data->throwingInstance = parent;
		Data->Mode = ((Data->Mode & ~0x1090) | 0x400004);

		instance->zAccl = -10;
	}

	instance->xVel = 0;
	instance->yVel = 0;
	instance->zVel = 0;
	instance->xAccl = 0;
	instance->yAccl = 0;
}


void PhysicalRelocateTune(struct Object* object, long offset) // Matching - 100%
{
	struct PhysObWeaponProperties* properties;
	struct _PhysObLight* pLight;

	properties = (struct PhysObWeaponProperties*)object->data;

	if (properties != NULL)
	{
		if (properties->Properties.family == 0)
		{
			pLight = (struct _PhysObLight*)OFFSET_DATA(properties->WeaponAttributes.Light, offset);

			properties->WeaponAttributes.Light = pLight;

			if (pLight != NULL)
			{
				pLight->lightTable = (struct LightTableEntry*)OFFSET_DATA(pLight->lightTable, offset);
			}

			properties->WeaponAttributes.splinter.splinterData = (void*)OFFSET_DATA(properties->WeaponAttributes.splinter.splinterData, offset);
		}

		if (properties->Properties.family == 3)
		{
			struct PhysObInteractProperties* prop;
			struct PhysObWeaponAttributes* weapon;

			prop = (struct PhysObInteractProperties*)object->data;

			prop->weapon = (struct PhysObWeaponAttributes*)OFFSET_DATA(prop->weapon, offset);

			weapon = prop->weapon;

			if (weapon != NULL)
			{
				weapon->Light = (struct _PhysObLight*)OFFSET_DATA(weapon->Light, offset);

				pLight = weapon->Light;

				if (pLight != NULL)
				{
					pLight->lightTable = (struct LightTableEntry*)OFFSET_DATA(pLight->lightTable, offset);
				}

				weapon->splinter.splinterData = (void*)OFFSET_DATA(weapon->splinter.splinterData, offset);
			}
		}

		if (properties->Properties.family == 7)
		{
			struct __PhysObProjectileProperties* prop;
			struct __PhysObProjectileData* temp;  // not from SYMDUMP

			prop = (struct __PhysObProjectileProperties*)object->data;

			prop->data = (struct __PhysObProjectileData*)OFFSET_DATA(prop->data, offset);

			if (prop->data != NULL)
			{
				int i;

				temp = prop->data;

				for (i = 0; i < prop->totalProjectiles; i++)
				{
					temp[i].weapon = (struct PhysObWeaponAttributes*)OFFSET_DATA(temp[i].weapon, offset);

					if (temp[i].weapon != NULL)
					{
						pLight = temp[i].weapon->Light;

						if (pLight != NULL)
						{
							pLight->lightTable = (struct LightTableEntry*)OFFSET_DATA(pLight->lightTable, offset);
						}
					}
				}
			}
		}
	}
}


int PHYSOBS_CheckObjectAxisAlignment(MATRIX* m0, MATRIX* m1, struct _SVector* axis)  // Matching - 100%
{
	VECTOR r0;
	VECTOR r1;
	struct _SVector v0;
	struct _SVector v1;

	ApplyMatrix(m0, (SVECTOR*)axis, &r0);

	ApplyMatrix(m1, (SVECTOR*)axis, &r1);

	v0.x = (short)r0.vx;
	v0.y = (short)r0.vy;
	v0.z = (short)r0.vz;

	v1.x = (short)r1.vx;
	v1.y = (short)r1.vy;
	v1.z = (short)r1.vz;

	return (((v0.x * v1.x) + (v0.y * v1.y) + (v0.z * v1.z)) * 16) >> 16;
}


int PHYSOB_CheckSlide(struct _Instance* instance, int x, int y, struct evPhysicsSlideData** data) // Matching - 100%
{
	*data = (struct evPhysicsSlideData*)SetPhysicsSlideData(1, (short)(x * 704), (short)(y * 704), 0, 640, 640, -160);

	return PhysicsCheckSliding(instance, (int)*data, 1);
}


int PHYSOB_CheckSlide2(struct _Instance* instance, int x, int y, struct evPhysicsSlideData** data) // Matching - 100%
{
	*data = (struct evPhysicsSlideData*)SetPhysicsSlideData(1, (short)(x * 704), (short)(y * 704), 0, 640, 640, -150);

	return PhysicsCheckSliding(instance, (int)*data, 1);
}


int PHYSOB_CheckDropOnSlope(struct _Instance* instance, int x, int y, struct evPhysicsSlideData** data) // Matching - 100%
{
	*data = (struct evPhysicsSlideData*)SetPhysicsSlideData(1, (short)(x * 704), (short)(y * 704), 0, 2560, 640, -160);

	return PhysicsCheckSliding(instance, (int)*data, 1);
}

int PHYSOB_CheckSlideNormal(struct _Instance* instance, int x, int y, struct evPhysicsSlideData** data) // Matching - 100%
{
	PHYSOB_NormalToAxis((short*)&x, (short*)&y);

	return PHYSOB_CheckSlide2(instance, x, y, data);
}


void PHYSOB_NormalToAxis(short* x, short* y) // Matching - 100%
{
	int x1;
	int y1;

	x1 = *x;

	y1 = *y;

	if (x1 >= 1025)
	{
		*x = 1;
	}
	else if (x1 < -1024)
	{
		*x = -1;
	}
	else
	{
		*x = 0;
	}

	if (y1 >= 1025)
	{
		*y = 1;
		return;
	}

	if (y1 < -1024)
	{
		*y = -1;
		return;
	}

	*y = 0;
}




